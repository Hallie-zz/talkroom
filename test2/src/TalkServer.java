import java.io.*;
import java.net.*;
import java.util.ArrayList;
import java.util.List;
//import java.util.Scanner;
public class TalkServer{
	//@SuppressWarnings("null")
	public static void main(String args[]) throws IOException {
		ServerSocket serverSocket=null;
		boolean listening=true;
		
		try{
			//创建一个ServerSocket在端口4700监听客户请求
			serverSocket=new ServerSocket(4700); 			
		}catch(IOException e) {
			System.out.println("Could not listen on port:4700.");
			//出错，打印出错信息
			System.exit(-1); //退出
		}
		List <Socket> sockets = new ArrayList<Socket>();
		while(listening){ //循环监听
		  //监听到客户请求，根据得到的Socket对象和客户计数创建服务线程，并启动之
			Socket s=serverSocket.accept();
			sockets.add(s);
			System.out.println("client"+s.getPort()+"已上线!");
				if(sockets.size()>1)
				{
					new ServerThread(sockets.get(0),sockets.get(1)).start();
					new ServerThread(sockets.get(1),sockets.get(0)).start();
					System.out.println("Now two clients connect!");
				}
		}
		serverSocket.close(); //关闭ServerSocket
	}
}
